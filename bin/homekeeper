#!/usr/bin/env python2
import homekeeper
import os
import sys

from pkg_resources import get_distribution

version = get_distribution('homekeeper').version

def print_usage():
    print 'homekeeper %s by Min Huang (min.huang@alumni.usc.edu)' % version
    print ''
    print 'Usage: homekeeper <command>'
    print ''
    print '<commands>'
    print '  link    symlink dotfiles to home directory'
    print '  save    save last commit to master branch'
    print '  track   track a dotfile with homekeeper'
    print '  update  update dotfiles from git'

def parse_config():
    config = {}
    pathname = os.path.join(os.getenv('HOME'), '.homekeeper.conf')
    if os.path.exists(pathname):
        execfile(pathname, config)
    else:
        print "the ~/.homekeeper.conf doesn't exist; assuming defaults"
    return config

config = parse_config()
h = homekeeper.Homekeeper(config)
if len(sys.argv) == 2 and sys.argv[1] == 'save':
    h.save()
elif len(sys.argv) == 3 and sys.argv[1] == 'track':
    h.track(sys.argv[2])
elif len(sys.argv) == 2 and sys.argv[1] == 'update':
    h.update()
elif len(sys.argv) == 2 and sys.argv[1] == 'link':
    h.link()
else:
    print_usage()
